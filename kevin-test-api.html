<!DOCTYPE <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    
</head>
<body>

    <input type="text" id="input">
    <button id="submit" type="submit">Submit</button>

    <p id="json"></p>
    <p id="city-id"></p>
    <p id="trending"></p>

    <script type="text/javascript">

        //https://developers.zomato.com/documentation

        var submitButton = $("#submit");
        var inputField = $("#input");

        var userInput = "";

        var zomatoAPIKey = "e9a701115b6afc966a7343268747292a";

        // when the submit button is clicked...
        submitButton.on("click", function(event) {
            event.preventDefault();

            // generate the API URL based on user input
            userInput = inputField.val().trim();
            var formattedInput = userInput.replace(" ", "%20");
            var apiLocationURL = "https://developers.zomato.com/api/v2.1/locations?query=" + formattedInput;
            
            // ajax call to the locations endpoint
            $.ajax({
                url: apiLocationURL,
                method: "GET",
                headers: {
                    "user-key": zomatoAPIKey
                }
            }).then(function(data) {

                // log the response
                console.log(data);

                var locationID = data.location_suggestions[0].entity_id;

                // generate the API URL based on previous API response
                var apiTrendingFoodURL = "https://developers.zomato.com/api/v2.1/search?entity_type=city&count=5&entity_id=" + locationID;

                // ajax call to the search endpoint
                $.ajax({
                    url: apiTrendingFoodURL,
                    method: "GET",
                    headers: {
                        "user-key": zomatoAPIKey
                    }
                }).then(function(data) {

                    // log the response
                    console.log(data);

                    var restaurants = data.restaurants;

                    // loop through the restaurants array
                    for(var i = 0; i < restaurants.length; i++) {
                        
                        // gets the individual restaurant's data
                        var r = restaurants[i].restaurant;
                        var name = r.name;
                        var cuisine = r.cuisines;
                        var rating = r.user_rating.aggregate_rating;
                        var pricing = r.price_range;
                        var price = "";
                        var menu = r.menu_url;

                        // convert price integer to dollar signs
                        for(var j = 0; j < parseInt(pricing); j++) {
                            price += "$";
                        }

                        // create a new div to store the data, append everything
                        var newDiv = $("<div>");
                        newDiv.append($("<p>").text("Name: " + name));
                        newDiv.append($("<p>").text("Cuisine: " + cuisine));
                        newDiv.append($("<p>").text("Rating: " + rating));
                        newDiv.append($("<p>").text("Price: " + price));
                        newDiv.append($("<a>").attr("href", menu).text("Menu"));

                        // appends the new div to the existing "trending" div
                        $("#trending").append(newDiv);

                        $("#trending").append($("<hr>"));
                    }

                });


            });

        });

        
    </script>

</body>
</html>